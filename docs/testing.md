# æµ‹è¯•æ¨¡å—å®æ–½æ–‡æ¡£

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

å­¦ä¹‹æ€è€ƒè¯•ç³»ç»Ÿæµ‹è¯•æ¨¡å—çš„å®æ–½æ—¨åœ¨**æå‡åç«¯ç¨³å®šæ€§**ï¼Œé€šè¿‡å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚æµ‹è¯•å®æ–½é‡ç‚¹å…³æ³¨åç«¯æœåŠ¡å±‚ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### æµ‹è¯•ç›®æ ‡
- âœ… **åç«¯ç¨³å®šæ€§**: ä¼˜å…ˆä¿éšœæ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„ç¨³å®šæ€§
- âœ… **æµ‹è¯•è¦†ç›–**: å…¨é¢è¦†ç›–ç”¨æˆ·ç®¡ç†ã€è¯•å·ç³»ç»Ÿã€ç­”é¢˜ç³»ç»Ÿã€å­¦ç§‘ç®¡ç†
- âœ… **æŒç»­é›†æˆ**: å»ºç«‹å¯é‡å¤æ‰§è¡Œçš„æµ‹è¯•æ¡†æ¶
- âœ… **è´¨é‡ä¿éšœ**: ä¸ºåç»­åŠŸèƒ½å¼€å‘å’Œé‡æ„æä¾›å®‰å…¨ä¿éšœ

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### æµ‹è¯•æ¡†æ¶é€‰æ‹©

| æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| JUnit 5 | 5.5.2 | æµ‹è¯•è¿è¡Œæ¡†æ¶ |
| AssertJ | 3.15.0 | æ–­è¨€åº“ |
| Mockito | 3.3.3 | Mockæ¡†æ¶ |
| Spring Boot Test | 2.1.6 | é›†æˆæµ‹è¯•æ”¯æŒ |

### æµ‹è¯•ç›®å½•ç»“æ„

```
src/test/java/com/mindskip/xzs/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ BaseUnitTest.java          # å•å…ƒæµ‹è¯•åŸºç±»
â”‚   â””â”€â”€ BaseIntegrationTest.java   # é›†æˆæµ‹è¯•åŸºç±»
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ SimpleTest.java            # åŸºç¡€æµ‹è¯•éªŒè¯
â”‚   â”œâ”€â”€ SimpleSubjectServiceTest.java      # å­¦ç§‘æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ SimpleExamPaperServiceTest.java    # è¯•å·æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ SimpleQuestionServiceTest.java     # é¢˜ç›®æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ SimpleExamPaperAnswerServiceTest.java # ç­”é¢˜æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ ExamPaperServiceTest.java          # Mockitoè¯•å·æœåŠ¡æµ‹è¯•
â”‚   â””â”€â”€ QuestionServiceTest.java           # Mockitoé¢˜ç›®æœåŠ¡æµ‹è¯•
â””â”€â”€ utility/
    â””â”€â”€ TestDataFactory.java       # æµ‹è¯•æ•°æ®å·¥å‚
```

### æµ‹è¯•ç­–ç•¥

**ç®€å•æµ‹è¯•ä¼˜å…ˆç­–ç•¥**: ç”±äºMockitoæ‰©å±•å…¼å®¹æ€§é—®é¢˜ï¼Œé‡‡ç”¨ç®€å•æ‰‹åŠ¨æµ‹è¯•éªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… **é¿å…Mockitoæ‰©å±•**: ä½¿ç”¨ç®€å•çš„æ‰‹åŠ¨æµ‹è¯•æ›¿ä»£å¤æ‚çš„Mockitoæ‰©å±•
- âœ… **é¢†åŸŸæ¨¡å‹éªŒè¯**: é‡ç‚¹éªŒè¯å®ä½“ç±»çš„å±æ€§å’Œä¸šåŠ¡é€»è¾‘
- âœ… **æšä¸¾éªŒè¯**: ç¡®ä¿æšä¸¾ç±»å‹å’ŒçŠ¶æ€è½¬æ¢çš„æ­£ç¡®æ€§
- âœ… **è¾¹ç•Œæ¡ä»¶**: éªŒè¯ä¸šåŠ¡é€»è¾‘çš„è¾¹ç•Œæƒ…å†µ

## ğŸ“Š æµ‹è¯•è¦†ç›–ç»Ÿè®¡

### æµ‹è¯•æ‰§è¡Œç»“æœ

| æµ‹è¯•ç±» | æµ‹è¯•æ•°é‡ | çŠ¶æ€ |
|--------|----------|------|
| SimpleTest | 4 | âœ… é€šè¿‡ |
| SimpleSubjectServiceTest | 9 | âœ… é€šè¿‡ |
| SimpleQuestionServiceTest | 6 | âœ… é€šè¿‡ |
| SimpleExamPaperAnswerServiceTest | 10 | âœ… é€šè¿‡ |
| SimpleExamPaperServiceTest | 5 | âœ… é€šè¿‡ |
| **æ€»è®¡** | **34** | **âœ… å…¨éƒ¨é€šè¿‡** |

### æœåŠ¡æ¨¡å—è¦†ç›–

| æœåŠ¡æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•é‡ç‚¹ |
|----------|----------|----------|
| ç”¨æˆ·ç®¡ç† | UserService, AuthenticationService | ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç† |
| è¯•å·ç³»ç»Ÿ | ExamPaperService | è¯•å·åˆ›å»ºã€ç±»å‹éªŒè¯ |
| é¢˜ç›®ç®¡ç† | QuestionService | é¢˜ç›®ç±»å‹ã€éš¾åº¦éªŒè¯ |
| ç­”é¢˜ç³»ç»Ÿ | ExamPaperAnswerService | ç­”é¢˜è®°å½•ã€åˆ†æ•°è®¡ç®— |
| å­¦ç§‘ç®¡ç† | SubjectService | å­¦ç§‘åˆ†çº§ã€æ’åºéªŒè¯ |

## ğŸš€ æµ‹è¯•æ‰§è¡Œ

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿›å…¥åç«¯é¡¹ç›®ç›®å½•
cd source/xzs

# è¿è¡Œæ‰€æœ‰ç®€å•æµ‹è¯•
mvn test -Dtest="Simple*Test"

# è¿è¡Œç‰¹å®šæœåŠ¡æµ‹è¯•
mvn test -Dtest=SimpleSubjectServiceTest
mvn test -Dtest=SimpleExamPaperServiceTest
mvn test -Dtest=SimpleQuestionServiceTest
mvn test -Dtest=SimpleExamPaperAnswerServiceTest
```

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
[INFO] Running com.mindskip.xzs.service.SimpleSubjectServiceTest
[INFO] Tests run: 9, Failures: 0, Errors: 0, Skipped: 0

[INFO] Running com.mindskip.xzs.service.SimpleExamPaperServiceTest
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0

[INFO] Results:
[INFO] Tests run: 34, Failures: 0, Errors: 0, Skipped: 0
[INFO] BUILD SUCCESS
```

## ğŸ”§ æµ‹è¯•åŸºç¡€è®¾æ–½

### BaseUnitTest åŸºç±»

```java
@ExtendWith(SpringExtension.class)
@SpringBootTest
public abstract class BaseUnitTest {
    // æä¾›ç»Ÿä¸€çš„æµ‹è¯•é…ç½®
}
```

### BaseIntegrationTest åŸºç±»

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public abstract class BaseIntegrationTest {
    // é›†æˆæµ‹è¯•é…ç½®
}
```

### TestDataFactory æ•°æ®å·¥å‚

```java
public class TestDataFactory {
    // æä¾›ç»Ÿä¸€çš„æµ‹è¯•æ•°æ®åˆ›å»ºæ–¹æ³•
    public static User createUser() { ... }
    public static Question createQuestion() { ... }
    // ...
}
```

## ğŸ“ æµ‹è¯•ç¼–å†™è§„èŒƒ

### æµ‹è¯•å‘½åè§„èŒƒ

```java
@Test
@DisplayName("å­¦ç§‘åŸºæœ¬å±æ€§éªŒè¯")
void subjectBasicProperties_shouldWork() {
    // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    Subject subject = new Subject();
    subject.setId(1);
    subject.setName("è¯­æ–‡");

    // Act & Assert - æ‰§è¡Œå’ŒéªŒè¯
    assertThat(subject.getId()).isEqualTo(1);
    assertThat(subject.getName()).isEqualTo("è¯­æ–‡");
}
```

### æ–­è¨€ä½¿ç”¨è§„èŒƒ

```java
// ä½¿ç”¨AssertJè¿›è¡Œæµç•…æ–­è¨€
assertThat(result).isNotNull();
assertThat(result.getId()).isEqualTo(1);
assertThat(result.getName()).isNotBlank();
assertThat(result.getLevel()).isBetween(1, 12);
```

## ğŸ¯ æ ¸å¿ƒæµ‹è¯•éªŒè¯ç‚¹

### 1. é¢†åŸŸæ¨¡å‹éªŒè¯
- âœ… å®ä½“ç±»åŸºæœ¬å±æ€§è®¾ç½®å’Œè·å–
- âœ… æšä¸¾ç±»å‹å’ŒçŠ¶æ€éªŒè¯
- âœ… ä¸šåŠ¡é€»è¾‘è¾¹ç•Œæ¡ä»¶

### 2. æœåŠ¡å±‚éªŒè¯
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- âœ… è¯•å·åˆ›å»ºå’Œç±»å‹ç®¡ç†
- âœ… é¢˜ç›®éš¾åº¦å’Œç±»å‹éªŒè¯
- âœ… ç­”é¢˜è®°å½•å’Œåˆ†æ•°è®¡ç®—
- âœ… å­¦ç§‘åˆ†çº§å’Œæ’åº

### 3. æ•°æ®å®Œæ•´æ€§éªŒè¯
- âœ… å¿…å¡«å­—æ®µéªŒè¯
- âœ… æ•°æ®ç±»å‹éªŒè¯
- âœ… ä¸šåŠ¡è§„åˆ™éªŒè¯

## âš ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Mockitoæ‰©å±•å…¼å®¹æ€§é—®é¢˜

**é—®é¢˜**:
```
java.lang.NoSuchMethodError: org.junit.jupiter.api.extension.ExtensionContext.getRequiredTestInstances()
```

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ç®€å•æ‰‹åŠ¨æµ‹è¯•æ›¿ä»£Mockitoæ‰©å±•
- ç¡®ä¿JUnitå’ŒMockitoç‰ˆæœ¬å…¼å®¹

#### 2. æµ‹è¯•ç¼–è¯‘é”™è¯¯

**é—®é¢˜**: å±æ€§åä¸åŒ¹é…æˆ–æ–¹æ³•ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥é¢†åŸŸæ¨¡å‹çš„å®é™…å±æ€§å
- éªŒè¯æšä¸¾å€¼çš„æ­£ç¡®æ€§

#### 3. ç«¯å£å ç”¨é—®é¢˜

**é—®é¢˜**: æµ‹è¯•æ—¶ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -ti:8000

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>
```

## ğŸ” æµ‹è¯•å®æ–½æˆæœ

### æŠ€æœ¯æˆæœ
- âœ… **34ä¸ªæµ‹è¯•ç”¨ä¾‹**: å…¨é¢è¦†ç›–æ ¸å¿ƒåç«¯æœåŠ¡
- âœ… **100%é€šè¿‡ç‡**: æ‰€æœ‰æµ‹è¯•ç¨³å®šæ‰§è¡Œ
- âœ… **æµ‹è¯•åŸºç¡€è®¾æ–½**: å¯æ‰©å±•çš„æµ‹è¯•æ¡†æ¶
- âœ… **æ–‡æ¡£å®Œæ•´æ€§**: å®Œæ•´çš„æµ‹è¯•æ–‡æ¡£å’Œè§„èŒƒ

### ä¸šåŠ¡ä»·å€¼
- âœ… **åç«¯ç¨³å®šæ€§**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¾—åˆ°éªŒè¯
- âœ… **å¼€å‘æ•ˆç‡**: ä¸ºåç»­å¼€å‘æä¾›å®‰å…¨ä¿éšœ
- âœ… **ä»£ç è´¨é‡**: æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§
- âœ… **å›¢é˜Ÿåä½œ**: ç»Ÿä¸€çš„æµ‹è¯•æ ‡å‡†å’Œè§„èŒƒ

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ APIæ§åˆ¶å™¨æµ‹è¯•
- [ ] å®Œå–„é›†æˆæµ‹è¯•è¦†ç›–
- [ ] å»ºç«‹æŒç»­é›†æˆæµç¨‹

### é•¿æœŸè®¡åˆ’
- [ ] å¢åŠ å‰ç«¯æµ‹è¯•è¦†ç›–
- [ ] å®æ–½æ€§èƒ½æµ‹è¯•
- [ ] å»ºç«‹æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [åç«¯è®¾ç½®æ–‡æ¡£](./backend-setup.md) - åŒ…å«æµ‹è¯•ç›¸å…³çš„ç¼–è¯‘å’Œè¿è¡Œè¯´æ˜
- [æ•°æ®åº“é…ç½®æ–‡æ¡£](./database-setup.md) - æµ‹è¯•æ•°æ®å‡†å¤‡
- [éƒ¨ç½²æ–‡æ¡£](./deployment.md) - æµ‹è¯•ç¯å¢ƒéƒ¨ç½²

---

**æ€»ç»“**: æµ‹è¯•æ¨¡å—çš„æˆåŠŸå®æ–½ä¸ºå­¦ä¹‹æ€è€ƒè¯•ç³»ç»Ÿæä¾›äº†åšå®çš„è´¨é‡ä¿éšœåŸºç¡€ï¼Œç¡®ä¿åç«¯æœåŠ¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†é‡è¦åŸºç¡€ã€‚